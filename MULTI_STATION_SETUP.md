# ğŸŒŠ Multi-Station District Database Setup Guide

This guide explains the new multi-station setup for your Groundwater Insights app with 4 monitoring stations across 2 districts.

## ğŸ“ Current Configuration

### ğŸŒ¾ **Eluru District**
- **Station 1**: `water_levels` table
- **Station 2**: `water_levels2` table
- **Color**: Green (#059669)
- **Icon**: ğŸŒ¾ (Agriculture/Rice fields)

### ğŸï¸ **Krishna District**  
- **Station 1**: `water_levels3` table
- **Station 2**: `water_levels4` table
- **Color**: Blue (#2563eb)
- **Icon**: ğŸï¸ (Landscape/River)

## ğŸ› ï¸ Database Setup Required

You need to create the new tables for the Krishna District stations:

### Step 1: Create Krishna Station 1 Table (`water_levels3`)

```sql
-- Create table for Krishna District Station 1
CREATE TABLE water_levels3 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    timestamp TIMESTAMPTZ DEFAULT NOW(),
    water_level NUMERIC,
    pressure NUMERIC,
    temperature NUMERIC,
    battery_level NUMERIC,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable Row Level Security
ALTER TABLE water_levels3 ENABLE ROW LEVEL SECURITY;

-- Create policies for authenticated users
CREATE POLICY "Enable read access for authenticated users" ON water_levels3
    FOR SELECT USING (auth.role() = 'authenticated');

CREATE POLICY "Enable insert access for authenticated users" ON water_levels3
    FOR INSERT WITH CHECK (auth.role() = 'authenticated');

CREATE POLICY "Enable update access for authenticated users" ON water_levels3
    FOR UPDATE USING (auth.role() = 'authenticated');

-- Enable real-time subscriptions
ALTER PUBLICATION supabase_realtime ADD TABLE water_levels3;
```

### Step 2: Create Krishna Station 2 Table (`water_levels4`)

```sql
-- Create table for Krishna District Station 2
CREATE TABLE water_levels4 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    timestamp TIMESTAMPTZ DEFAULT NOW(),
    water_level NUMERIC,
    pressure NUMERIC,
    temperature NUMERIC,
    battery_level NUMERIC,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable Row Level Security
ALTER TABLE water_levels4 ENABLE ROW LEVEL SECURITY;

-- Create policies for authenticated users
CREATE POLICY "Enable read access for authenticated users" ON water_levels4
    FOR SELECT USING (auth.role() = 'authenticated');

CREATE POLICY "Enable insert access for authenticated users" ON water_levels4
    FOR INSERT WITH CHECK (auth.role() = 'authenticated');

CREATE POLICY "Enable update access for authenticated users" ON water_levels4
    FOR UPDATE USING (auth.role() = 'authenticated');

-- Enable real-time subscriptions
ALTER PUBLICATION supabase_realtime ADD TABLE water_levels4;
```

### Step 3: Add Sample Data (Optional)

```sql
-- Sample data for Krishna Station 1
INSERT INTO water_levels3 (water_level, pressure, temperature, battery_level) VALUES
    (18.5, 142.3, 19.8, 91.0),
    (18.3, 141.8, 20.1, 90.5),
    (18.7, 142.9, 19.6, 90.0),
    (18.4, 142.1, 19.9, 89.5),
    (18.6, 142.6, 19.7, 89.0);

-- Sample data for Krishna Station 2  
INSERT INTO water_levels4 (water_level, pressure, temperature, battery_level) VALUES
    (16.2, 138.7, 21.2, 87.0),
    (16.0, 138.1, 21.5, 86.5),
    (16.4, 139.3, 20.9, 86.0),
    (16.1, 138.4, 21.3, 85.5),
    (16.3, 139.0, 21.1, 85.0);
```

## ğŸ¯ How the New System Works

### ğŸ“± **User Experience Flow**

1. **Login** â†’ User authenticates
2. **District Selection** â†’ Choose between Eluru or Krishna
3. **Station Selection** â†’ Choose specific monitoring station within district
4. **Data Viewing** â†’ View data from selected station
5. **Easy Switching** â†’ Switch between districts/stations anytime

### ğŸ”„ **Two-Level Selection Process**

#### Level 1: District Selection
- **Eluru District** ğŸŒ¾ â†’ Shows 2 available stations
- **Krishna District** ğŸï¸ â†’ Shows 2 available stations

#### Level 2: Station Selection  
- **Eluru Station 1** â†’ `water_levels` table
- **Eluru Station 2** â†’ `water_levels2` table  
- **Krishna Station 1** â†’ `water_levels3` table
- **Krishna Station 2** â†’ `water_levels4` table

### ğŸ“Š **Table Mapping Summary**

| District | Station | Table Name | Status |
|----------|---------|------------|--------|
| Eluru | Station 1 | `water_levels` | âœ… Existing |
| Eluru | Station 2 | `water_levels2` | âœ… Existing |
| Krishna | Station 1 | `water_levels3` | ğŸ†• New (needs creation) |
| Krishna | Station 2 | `water_levels4` | ğŸ†• New (needs creation) |

## ğŸ¨ **Visual Design**

### District Cards
- **Eluru**: Green theme with agriculture icon ğŸŒ¾
- **Krishna**: Blue theme with landscape icon ğŸï¸
- Show station count for each district

### Station Cards
- Location pin icon ğŸ“ for all stations
- District color coding
- Table name display for technical reference
- Clear descriptions for each station

## ğŸš€ **Quick Setup Commands**

Run all these commands in your Supabase SQL editor:

```sql
-- Complete setup for Krishna District stations
BEGIN;

-- Krishna Station 1 (water_levels3)
CREATE TABLE water_levels3 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    timestamp TIMESTAMPTZ DEFAULT NOW(),
    water_level NUMERIC,
    pressure NUMERIC,
    temperature NUMERIC,
    battery_level NUMERIC,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

ALTER TABLE water_levels3 ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Enable read access for authenticated users" ON water_levels3
    FOR SELECT USING (auth.role() = 'authenticated');
CREATE POLICY "Enable insert access for authenticated users" ON water_levels3
    FOR INSERT WITH CHECK (auth.role() = 'authenticated');
ALTER PUBLICATION supabase_realtime ADD TABLE water_levels3;

-- Krishna Station 2 (water_levels4)
CREATE TABLE water_levels4 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    timestamp TIMESTAMPTZ DEFAULT NOW(),
    water_level NUMERIC,
    pressure NUMERIC,
    temperature NUMERIC,
    battery_level NUMERIC,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

ALTER TABLE water_levels4 ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Enable read access for authenticated users" ON water_levels4
    FOR SELECT USING (auth.role() = 'authenticated');
CREATE POLICY "Enable insert access for authenticated users" ON water_levels4
    FOR INSERT WITH CHECK (auth.role() = 'authenticated');
ALTER PUBLICATION supabase_realtime ADD TABLE water_levels4;

-- Add indexes for better performance
CREATE INDEX idx_water_levels3_timestamp ON water_levels3 (timestamp);
CREATE INDEX idx_water_levels4_timestamp ON water_levels4 (timestamp);

COMMIT;
```

## âœ… **Testing Checklist**

After creating the tables, test these scenarios:

### ğŸŒ¾ **Eluru District Testing**
- [ ] Can select Eluru District
- [ ] See 2 stations available
- [ ] Can select Eluru Station 1 (water_levels)
- [ ] Can select Eluru Station 2 (water_levels2)  
- [ ] Data loads correctly for each station
- [ ] Can switch between Eluru stations

### ğŸï¸ **Krishna District Testing**
- [ ] Can select Krishna District
- [ ] See 2 stations available
- [ ] Can select Krishna Station 1 (water_levels3)
- [ ] Can select Krishna Station 2 (water_levels4)
- [ ] Data loads correctly for each station
- [ ] Can switch between Krishna stations

### ğŸ”„ **Cross-District Testing**
- [ ] Can switch from Eluru to Krishna
- [ ] Can switch from Krishna to Eluru
- [ ] Real-time updates work for all stations
- [ ] Charts show correct data per station
- [ ] Header shows current district/station properly

## ğŸ¯ **User Interface Features**

### **District Selection Screen**
- Beautiful cards with district icons and colors
- Station count display
- Smooth animations and transitions

### **Station Selection Screen**  
- Back button to return to districts
- Clear station identification
- Table name display for technical users
- Selection indicators

### **Header Display**
- Shows: "District Name - Station Name"
- Example: "Krishna District - Krishna Station 1"
- Color-coded button for easy switching

## ğŸ”§ **Troubleshooting**

### **Station Not Appearing**
1. Check table exists in database
2. Verify table has correct permissions
3. Ensure real-time is enabled for table
4. Check console for errors

### **Data Not Loading**
1. Verify table has sample data
2. Check RLS policies are correct
3. Ensure user is authenticated
4. Test direct table queries in Supabase

### **Real-time Not Working**
1. Verify table is in supabase_realtime publication
2. Check subscription setup in app
3. Test with manual data insertion

Your Groundwater Insights app now supports 4 monitoring stations across Krishna and Eluru districts! ğŸŒŠğŸ“ğŸï¸ğŸŒ¾
